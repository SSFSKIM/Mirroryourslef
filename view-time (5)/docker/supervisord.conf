[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
loglevel=info

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=5
numprocs=1
startsecs=5
stopwaitsecs=10
stderr_logfile=/var/log/supervisor/nginx.err.log
stdout_logfile=/var/log/supervisor/nginx.out.log
priority=10

[program:fastapi]
command=uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
directory=/app/backend
autostart=true
autorestart=true
startretries=5
numprocs=1
startsecs=5
stopwaitsecs=10
stderr_logfile=/var/log/supervisor/fastapi.err.log
stdout_logfile=/var/log/supervisor/fastapi.out.log
environment=PYTHONPATH="/app/backend",PYTHONUNBUFFERED="1"
priority=20

# Optional: Background task worker (uncomment if needed)
# [program:worker]
# command=python -m app.worker
# directory=/app/backend
# autostart=true
# autorestart=true
# startretries=5
# stderr_logfile=/var/log/supervisor/worker.err.log
# stdout_logfile=/var/log/supervisor/worker.out.log
# environment=PYTHONPATH="/app/backend",PYTHONUNBUFFERED="1"
# priority=30

[group:youtube-stats]
programs=nginx,fastapi
priority=999
